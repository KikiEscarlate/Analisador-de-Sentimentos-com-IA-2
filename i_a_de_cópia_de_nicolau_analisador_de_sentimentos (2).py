# -*- coding: utf-8 -*-
"""I.A de C√≥pia de NICOLAU Analisador de sentimentos.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1tpxuOB87mQpXPp55rbXmVXzp-LjcFxbZ
"""

"""
ANALISADOR DE SENTIMENTOS COM IA
An√°lise de sentimentos usando modelo Transformer pr√©-treinado
Autor: Turma de Engenharia de Software
Vers√£o: 2.0 (Refatorada)
"""

from transformers import pipeline
from typing import Optional, Dict
import sys


class AnalisadorSentimentos:
    """Classe para an√°lise de sentimentos usando modelo de IA."""

    MODELO_ID = "pysentimiento/bertweet-pt-sentiment"

    # Mapeamento de labels para descri√ß√µes em portugu√™s
    SENTIMENTOS = {
        'POS': {'emoji': 'üòä', 'texto': 'POSITIVO'},
        'NEG': {'emoji': 'üòû', 'texto': 'NEGATIVO'},
        'NEU': {'emoji': 'üòê', 'texto': 'NEUTRO'}
    }

    def __init__(self):
        """Inicializa o analisador (modelo ser√° carregado sob demanda)."""
        self._analisador = None

    def carregar_modelo(self) -> bool:
        """
        Carrega o modelo de IA.

        Returns:
            bool: True se carregado com sucesso, False caso contr√°rio
        """
        try:
            print("\n" + "="*60)
            print("ü§ñ Carregando modelo de Intelig√™ncia Artificial...")
            print(f"üì¶ Modelo: {self.MODELO_ID}")
            print("‚è≥ Aguarde, pode levar alguns segundos...")
            print("="*60)

            self._analisador = pipeline(
                "sentiment-analysis",
                model=self.MODELO_ID
            )

            print("‚úÖ Modelo carregado com sucesso!\n")
            return True

        except Exception as e:
            print(f"‚ùå Erro ao carregar modelo: {e}")
            return False

    def analisar(self, frase: str) -> Optional[Dict]:
        """
        Analisa o sentimento de uma frase.

        Args:
            frase: Texto a ser analisado

        Returns:
            Dicion√°rio com label e score, ou None em caso de erro
        """
        if self._analisador is None:
            print("‚ùå ERRO: Modelo n√£o foi carregado!")
            return None

        if not frase or not frase.strip():
            print("‚ö†Ô∏è Frase vazia n√£o pode ser analisada!")
            return None

        try:
            resultado = self._analisador(frase.strip())[0]
            return resultado
        except Exception as e:
            print(f"‚ùå Erro na an√°lise: {e}")
            return None

    def exibir_resultado(self, frase: str, resultado: Dict) -> None:
        """
        Exibe o resultado da an√°lise de forma formatada.

        Args:
            frase: Texto analisado
            resultado: Dicion√°rio retornado pela IA
        """
        print("\n" + "="*60)
        print("üìä RESULTADO DA AN√ÅLISE")
        print("="*60)
        print(f'üí¨ Frase: "{frase}"')
        print("-"*60)

        label = resultado['label']
        confianca = resultado['score']

        sentimento = self.SENTIMENTOS.get(label, {'emoji': '‚ùì', 'texto': 'DESCONHECIDO'})

        print(f"{sentimento['emoji']} Sentimento: {sentimento['texto']}")
        print(f"üìà Confian√ßa: {confianca * 100:.2f}%")
        print("="*60)


class Menu:
    """Classe para gerenciar o menu interativo."""

    def __init__(self, analisador: AnalisadorSentimentos):
        """
        Inicializa o menu.

        Args:
            analisador: Inst√¢ncia do AnalisadorSentimentos
        """
        self.analisador = analisador

    def exibir_menu(self) -> None:
        """Exibe as op√ß√µes do menu."""
        print("\n" + "="*60)
        print("üìã MENU PRINCIPAL")
        print("="*60)
        print("1Ô∏è‚É£  Analisar uma frase")
        print("2Ô∏è‚É£  Analisar m√∫ltiplas frases")
        print("3Ô∏è‚É£  Sobre o modelo de IA")
        print("4Ô∏è‚É£  Sair")
        print("="*60)

    def opcao_analisar_frase(self) -> None:
        """Op√ß√£o para analisar uma √∫nica frase."""
        print("\n" + "-"*60)
        frase = input("üí¨ Digite a frase para an√°lise: ").strip()

        if not frase:
            print("‚ö†Ô∏è Nenhuma frase foi digitada!")
            return

        resultado = self.analisador.analisar(frase)
        if resultado:
            self.analisador.exibir_resultado(frase, resultado)

    def opcao_analisar_multiplas(self) -> None:
        """Op√ß√£o para analisar m√∫ltiplas frases."""
        print("\n" + "-"*60)
        print("üìù Digite as frases (uma por linha)")
        print("üí° Digite 'FIM' quando terminar")
        print("-"*60)

        frases = []
        while True:
            frase = input(f"Frase {len(frases) + 1}: ").strip()

            if frase.upper() == 'FIM':
                break

            if frase:
                frases.append(frase)

        if not frases:
            print("‚ö†Ô∏è Nenhuma frase foi digitada!")
            return

        print(f"\nüîç Analisando {len(frases)} frase(s)...\n")

        for i, frase in enumerate(frases, 1):
            resultado = self.analisador.analisar(frase)
            if resultado:
                print(f"\n--- An√°lise {i}/{len(frases)} ---")
                self.analisador.exibir_resultado(frase, resultado)

    def opcao_sobre_modelo(self) -> None:
        """Exibe informa√ß√µes sobre o modelo."""
        print("\n" + "="*60)
        print("‚ÑπÔ∏è  SOBRE O MODELO")
        print("="*60)
        print(f"ü§ñ Modelo: {AnalisadorSentimentos.MODELO_ID}")
        print("üìö Tipo: Transformer (BERT)")
        print("üåç Idioma: Portugu√™s")
        print("üéØ Tarefa: An√°lise de Sentimentos")
        print("\nüí° Como funciona:")
        print("   ‚Ä¢ Modelo pr√©-treinado com milhares de exemplos")
        print("   ‚Ä¢ Entende contexto e nuances da linguagem")
        print("   ‚Ä¢ N√£o precisa de dicion√°rio manual de palavras")
        print("   ‚Ä¢ Retorna confian√ßa da predi√ß√£o (0-100%)")
        print("="*60)

    def executar(self) -> None:
        """Loop principal do menu."""
        while True:
            self.exibir_menu()
            opcao = input("üëâ Escolha uma op√ß√£o (1-4): ").strip()

            if opcao == "1":
                self.opcao_analisar_frase()

            elif opcao == "2":
                self.opcao_analisar_multiplas()

            elif opcao == "3":
                self.opcao_sobre_modelo()

            elif opcao == "4":
                print("\n" + "="*60)
                print("üëã Obrigado por usar o Analisador de Sentimentos!")
                print("="*60 + "\n")
                sys.exit(0)

            else:
                print("\n‚ö†Ô∏è Op√ß√£o inv√°lida! Escolha entre 1 e 4.")


def main():
    """Fun√ß√£o principal do programa."""
    print("="*60)
    print("üíô ANALISADOR DE SENTIMENTOS COM IA")
    print("="*60)

    # Inicializar analisador
    analisador = AnalisadorSentimentos()

    # Carregar modelo
    if not analisador.carregar_modelo():
        print("‚ùå N√£o foi poss√≠vel iniciar o programa.")
        sys.exit(1)

    # Iniciar menu
    menu = Menu(analisador)
    menu.executar()


if __name__ == "__main__":
    main()